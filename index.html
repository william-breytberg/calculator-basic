<!DOCTYPE html>
<html>
<head>
<style>
  p{
    text-align:right;
    font-family: monospace;
    font-size: 600%;
    padding: 0.5%;
    margin: 0.5%;
    border: 2px solid black;
  }
  button{
    font-family: monospace;
    font-size: 600%;
    font-weight: bolder;
    margin: 0.5%;
    width: 18%;
    padding: 2% 0%;
    float: right;
  }
</style>
</head>
<body>

<p id="result">0</p>
  <button type="button" onclick="numberAppend('5')">5</button>
  <button type="button" onclick="numberAppend('4')">4</button>
  <button type="button" onclick="numberAppend('3')">3</button>
  <button type="button" onclick="numberAppend('2')">2</button>
  <button type="button" onclick="numberAppend('1')">1</button>
<br>
  <button type="button" onclick="numberAppend('0')">0</button>
  <button type="button" onclick="numberAppend('9')">9</button>
  <button type="button" onclick="numberAppend('8')">8</button>
  <button type="button" onclick="numberAppend('7')">7</button>
  <button type="button" onclick="numberAppend('6')">6</button>
<br>
  <button type="button" onclick="performOperation('%')">%</button>
  <button type="button" onclick="performOperation('d')">÷</button>
  <button type="button" onclick="performOperation('*')">×</button>
  <button type="button" onclick="performOperation('-')">-</button>
  <button type="button" onclick="performOperation('+')">+</button>
<br>
  <button type="button" onclick="completeOperation()">=</button>
  <button type="button" onclick="turnNegative()">±</button>
  <button type="button" onclick="decimalAppend()">.</button>
  <button type="button" onclick="numberDelete()">←</button>
  <button type="button" onclick="numberReset()">C</button>


<script>
const result = document.getElementById("result");

// holdNum is null when there's no pending left-hand operand
let holdNum = null;
let operation = '';

function formatResult(n){
  // limit to 12 significant digits to avoid long float strings
  const rounded = Number(n).toPrecision(12);
  // strip unnecessary trailing zeros/decimal
  return parseFloat(rounded).toString();
}

function numberAppend(num){
  if(result.innerText === '0'){
    result.innerText = num;
  } else {
    result.innerText += num;
  }
}

function turnNegative(){
  if(result.innerText.indexOf("-") === 0){
    result.innerText = result.innerText.slice(1);
  } else {
    result.innerText = "-" + result.innerText;
  }
}

function decimalAppend(){
  if(result.innerText.indexOf(".") < 0){
    result.innerText += ".";
  }
}

function numberReset(){
  result.innerText = '0';
  holdNum = null;
  operation = '';
}

function numberDelete(){
  if(result.innerText.length > 1){
    result.innerText = result.innerText.slice(0,-1);
    // if result becomes "-" alone, keep it as "0"
    if(result.innerText === "-" || result.innerText === "-0"){
      result.innerText = '0';
    }
  } else {
    result.innerText = '0'
  }
}

function performOperation(newOper){
  // If there's already a pending operation and a held number, compute it first (chaining)
  if(operation && holdNum !== null){
    const computeSuccess = compute();
    if(!computeSuccess) return; // e.g. division by zero -> stop
  }
  // store the current displayed number as the left-hand operand
  holdNum = parseFloat(result.innerText);
  operation = newOper;
  // prepare display for the next number
  result.innerText = '0';
}

function compute(){
  if(operation === '' || holdNum === null) return false;

  const current = parseFloat(result.innerText);

  let res;
  switch(operation){
    case '+':
      res = holdNum + current;
      break;
    case '-':
      res = holdNum - current;
      break;
    case '*':
      res = holdNum * current;
      break;
    case 'd':
      if (current === 0){
        alert("division by 0")
        numberReset()
        return false;
      }
      res = holdNum / current;
      break;
    case '%':
      // modulo with floats behaves like JS %
      res = holdNum % current;
      break;
    default:
      return false;
  }

  // format result to avoid long floating point artifacts
  result.innerText = formatResult(res);
  // after computing, clear the pending operation
  holdNum = null;
  operation = '';
  return true;
}

function completeOperation(){
  if(operation === '' || holdNum === null) {
    // nothing to do
    return;
  }
  compute();
}
</script>
</body>

</html>
