<!DOCTYPE html>
<html>
<head>
<style>
  p{
    text-align:right;
    font-family: monospace;
    font-size: 150%;
    padding: 2%;
    margin: 5%;
    border: 2px solid black;
  }
  button{
    font-family: monospace;
    font-size: 150%;
    margin: 2%;
    width: 20%;
    height: 20%;
  }
</style>
</head>
<body>

<p id="result">0</p>
  <button type="button" onclick="numberAppend('1')">1</button>
  <button type="button" onclick="numberAppend('2')">2</button>
  <button type="button" onclick="numberAppend('3')">3</button>
  <button type="button" onclick="performOperation('+')">+</button>
<br>
  <button type="button" onclick="numberAppend('4')">4</button>
  <button type="button" onclick="numberAppend('5')">5</button>
  <button type="button" onclick="numberAppend('6')">6</button>
  <button type="button" onclick="performOperation('*')">ร</button>
<br>
  <button type="button" onclick="numberAppend('7')">7</button>
  <button type="button" onclick="numberAppend('8')">8</button>
  <button type="button" onclick="numberAppend('9')">9</button>
  <button type="button" onclick="performOperation('d')">รท</button>
<br>
  <button type="button" onclick="decimalAppend()">.</button>
  <button type="button" onclick="numberAppend('0')">0</button>
  <button type="button" onclick="turnNegative()">-</button>
  <button type="button" onclick="performOperation('%')">%</button>
<br>
  <button type="button" onclick="numberReset()">CLEAR</button>
  <button type="button" onclick="numberDelete()">UNDO</button>
  <button type="button" onclick="completeOperation()">=</button>


<script>
const resultEl = document.getElementById("result");

// holdNum is null when there's no pending left-hand operand
let holdNum = null;
let operation = '';

function formatResult(n){
  if (!isFinite(n)) return 'Error';
  // limit to 12 significant digits to avoid long float strings
  const rounded = Number(n).toPrecision(12);
  // strip unnecessary trailing zeros/decimal
  return parseFloat(rounded).toString();
}

function numberAppend(num){
  if(resultEl.innerText === '0' || resultEl.innerText === 'Error'){
    resultEl.innerText = num;
  } else {
    resultEl.innerText += num;
  }
}

function turnNegative(){
  if(resultEl.innerText === 'Error') return;
  if(resultEl.innerText.indexOf("-") === 0){
    resultEl.innerText = resultEl.innerText.slice(1);
  } else {
    resultEl.innerText = "-" + resultEl.innerText;
  }
}

function decimalAppend(){
  if(resultEl.innerText === 'Error') return;
  if(resultEl.innerText.indexOf(".") < 0){
    resultEl.innerText += ".";
  }
}

function numberReset(){
  resultEl.innerText = '0';
  holdNum = null;
  operation = '';
}

function numberDelete(){
  if(resultEl.innerText === 'Error'){
    resultEl.innerText = '0';
    return;
  }
  if(resultEl.innerText.length > 1){
    resultEl.innerText = resultEl.innerText.slice(0,-1);
    // if result becomes "-" alone, keep it as "0"
    if(resultEl.innerText === "-" || resultEl.innerText === "-0"){
      resultEl.innerText = '0';
    }
  } else {
    resultEl.innerText = '0'
  }
}

function performOperation(newOper){
  if(resultEl.innerText === 'Error') return;

  // If there's already a pending operation and a held number, compute it first (chaining)
  if(operation && holdNum !== null){
    const computeSuccess = compute();
    if(!computeSuccess) return; // e.g. division by zero -> stop
  }

  // store the current displayed number as the left-hand operand
  holdNum = parseFloat(resultEl.innerText);
  operation = newOper;
  // prepare display for the next number
  resultEl.innerText = '0';
}

function compute(){
  if(operation === '' || holdNum === null) return false;

  const current = parseFloat(resultEl.innerText);

  let res;
  switch(operation){
    case '+':
      res = holdNum + current;
      break;
    case '*':
      res = holdNum * current;
      break;
    case 'd':
      if (current === 0){
        resultEl.innerText = 'Error';
        holdNum = null;
        operation = '';
        return false;
      }
      res = holdNum / current;
      break;
    case '%':
      // modulo with floats behaves like JS %
      res = holdNum % current;
      break;
    default:
      return false;
  }

  // format result to avoid long floating point artifacts
  resultEl.innerText = formatResult(res);
  // after computing, clear the pending operation
  holdNum = null;
  operation = '';
  return true;
}

function completeOperation(){
  if(resultEl.innerText === 'Error') return;
  if(operation === '' || holdNum === null) {
    // nothing to do
    return;
  }
  compute();
}
</script>
</body>
</html>